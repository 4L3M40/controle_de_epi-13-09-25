<!-- templates/emprestimos/emprestimo_list.html (lista de empréstimos, baseado em colaborador_list.html) -->
{% extends "base.html" %}
{% block title %}Empréstimos — EPI{% endblock %}
{% block content %}
  <div class="grid">
    <div class="card">
      <div class="card-inner" style="display:flex; justify-content:space-between; align-items:center;">
        <div>
          <h2 style="margin:0 0 6px">Empréstimos</h2>
          <div class="pill"><span>Total:</span> <strong>{{ emprestimos.count }}</strong></div>
        </div>
        {% if request.user.is_superuser or request.user.colaborador.perfil in 'ADMIN,ALMOXARIFE' %}
          <a class="btn primary" href="{% url 'emprestimos:create' %}">+ Novo Empréstimo</a>
        {% endif %}
      </div>
    </div>

    <div class="card">
      <div class="card-inner">
        <table class="table">
          <thead>
            <tr>
              <th>ID</th>
              <th>Colaborador</th>
              <th>Data Empréstimo</th>
              <th>Status</th>
              <th>Ações</th>
            </tr>
          </thead>
          <tbody>
          {% for emprestimo in emprestimos %}
            <tr>
              <td>{{ emprestimo.id }}</td>
              <td>{{ emprestimo.colaborador.nome }}</td>
              <td>{{ emprestimo.data_emprestimo }}</td>
              <td>{{ emprestimo.get_status_display }}</td>
              <td class="actions">
                {% if request.user.is_superuser or request.user.colaborador.perfil in 'ADMIN,ALMOXARIFE' %}
                  <a class="btn" href="{% url 'emprestimos:update' emprestimo.pk %}">Editar</a>
                  <a class="btn danger" href="{% url 'emprestimos:delete' emprestimo.pk %}">Excluir</a>
                {% else %}
                  <span class="badge tag-muted">Sem permissão</span>
                {% endif %}
              </td>
            </tr>
          {% empty %}
            <tr><td colspan="5">Nenhum empréstimo encontrado.</td></tr>
          {% endfor %}
          </tbody>
        </table>

        {% if is_paginated %}
        <div style="display:flex; gap:10px; align-items:center; justify-content:flex-end;">
          {% if page_obj.has_previous %}
            <a class="btn" href="?page={{ page_obj.previous_page_number }}&q={{ request.GET.q }}">Anterior</a>
          {% endif %}
          <span class="badge">Página {{ page_obj.number }} de {{ page_obj.paginator.num_pages }}</span>
          {% if page_obj.has_next %}
            <a class="btn" href="?page={{ page_obj.next_page_number }}&q={{ request.GET.q }}">Próxima</a>
          {% endif %}
        </div>
        {% endif %}
      </div>
    </div>
  </div>
{% endblock %}